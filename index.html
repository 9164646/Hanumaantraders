<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sri Hanumaan Trader's Lucky Draw</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        body {
            background: #2c3e50;
            font-family: 'Poppins', sans-serif;
            color: #fff;
            padding: 40px 0;
            margin: 0;
        }

        h1 {
            font-size: 3rem;
            color: #1E90FF;
            text-align: center;
            margin-bottom: 40px;
        }

        .btn-custom {
            background: #1E90FF;
            color: #fff;
            border: none;
            padding: 14px 22px;
            margin: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .btn-custom:hover {
            background: #4CAF50;
        }

        .hidden {
            display: none;
        }

        .table {
            background-color: #fff;
            color: #333;
        }

        th {
            background: #1E90FF;
            color: #fff;
        }

        .admin-panel {
            background: #34495e;
            padding: 20px;
            border-radius: 10px;
            margin-top: 40px;
        }
    </style>
</head>
<body>
<h1>Sri Hanumaan Trader's Lucky Draw</h1>

<div class="text-center">
    <button class="btn-custom" onclick="toggleAdminPanel()">Admin Panel</button>
    <button id="startDrawBtn" class="btn-custom" onclick="startDraw()">Start Lucky Draw</button>
    <button class="btn-custom" onclick="exportWinnersPDF()">Download PDF</button>
    <button class="btn-custom" onclick="resetWinners()">Reset Winners</button>
    <button class="btn-custom" onclick="exportWinnersExcel()">Export to Excel</button>
    <button class="btn-custom" onclick="deleteAllParticipants()">Delete All Participants</button>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="admin-panel hidden">
    <h2 class="text-center text-white">Manage Participants</h2>
    <div class="form-group">
        <input type="text" id="participantName" placeholder="Participant Name" class="form-control">
    </div>
    <div class="form-group">
        <input type="text" id="traderAddress" placeholder="Trader Address" class="form-control">
    </div>
    <div class="form-group">
        <input type="text" id="couponCode" placeholder="Coupon Code" class="form-control">
    </div>
    <button class="btn-custom" onclick="addParticipant()">Add Participant</button>
    <hr>
    <input type="file" id="fileInput" accept=".xlsx, .xls, .csv" class="form-control mb-3" onchange="uploadFile()">
    <table id="participantTable" class="table table-bordered">
        <thead>
            <tr><th>S. No</th><th>Name</th><th>Trader Address</th><th>Coupon Code</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- Winners List -->
<div id="winnerList" class="hidden">
    <h2 class="text-center text-white">Winners List</h2>
    <table id="winnersTable" class="table table-bordered">
        <thead><tr><th>S. No</th><th>Name</th><th>Prize</th><th>Gift</th><th>Coupon Code</th></tr></thead>
        <tbody></tbody>
    </table>
</div>

<script>
    let participants = JSON.parse(localStorage.getItem('participants')) || [];
    let winners = JSON.parse(localStorage.getItem('winners')) || [];

    function toggleAdminPanel() {
        document.getElementById('adminPanel').classList.toggle('hidden');
        renderTable();
    }

    function addParticipant() {
        const name = document.getElementById('participantName').value.trim();
        const traderAddress = document.getElementById('traderAddress').value.trim();
        const couponCode = document.getElementById('couponCode').value.trim();

        if (name && traderAddress && couponCode) {
            participants.push({ name, traderAddress, couponCode });
            localStorage.setItem('participants', JSON.stringify(participants));
            renderTable();
            alert('Participant added!');
        } else {
            alert('Please fill in all fields.');
        }
    }

    function deleteParticipant(index) {
        participants.splice(index, 1);
        localStorage.setItem('participants', JSON.stringify(participants));
        renderTable();
    }

    function startDraw() {
        const numWinners = parseInt(prompt('Enter number of winners:'), 10);
        if (isNaN(numWinners) || numWinners <= 0 || numWinners > participants.length) {
            alert('Invalid number of winners.');
            return;
        }

        winners = [];
        const shuffled = participants.sort(() => 0.5 - Math.random());
        for (let i = 0; i < numWinners; i++) {
            const winner = shuffled[i];
            const prize = prompt(`Enter prize for ${winner.name}:`, '');
            const gift = prompt(`Enter gift for ${winner.name}:`, '');
            winners.push({ ...winner, prize, gift });
        }

        localStorage.setItem('winners', JSON.stringify(winners));
        renderWinners();
    }

    function renderWinners() {
        const tbody = document.querySelector('#winnersTable tbody');
        tbody.innerHTML = winners.map((w, i) => 
            `<tr><td>${i + 1}</td><td>${w.name}</td><td>${w.prize}</td><td>${w.gift}</td><td>${w.couponCode}</td></tr>`
        ).join('');
        document.getElementById('winnerList').classList.remove('hidden');
    }

    function exportWinnersPDF() {
        const docDefinition = {
            content: [
                { text: 'Winners List', style: 'header' },
                { table: { body: [['S. No', 'Name', 'Prize', 'Gift', 'Coupon Code'], ...winners.map((w, i) => [i + 1, w.name, w.prize, w.gift, w.couponCode])]} }
            ],
            styles: { header: { fontSize: 18, bold: true } }
        };
        pdfMake.createPdf(docDefinition).download('winners.pdf');
    }

    function exportWinnersExcel() {
        const ws = XLSX.utils.json_to_sheet(winners);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Winners');
        XLSX.writeFile(wb, 'winners.xlsx');
    }

    renderTable();
    renderWinners();
</script>
</body>
</html>
