<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sri Hanumaan Trader's Lucky Draw</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body { background: #000; color: #fff; font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        h1 { color: #FFD700; margin-bottom: 20px; }
        .btn-custom { background: #FFD700; color: #000; border: none; padding: 10px 15px; margin: 5px; border-radius: 5px; cursor: pointer; }
        table { width: 100%; background: #fff; color: #000; margin-top: 20px; border-radius: 5px; }
        th, td { padding: 10px; border: 1px solid #ddd; }
        #winnerList { margin-top: 20px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>Sri Hanumaan Trader's Lucky Draw</h1>
    <button class="btn-custom" onclick="toggleAdminPanel()">Admin Panel</button>
    <button class="btn-custom" onclick="startDraw()">Start Lucky Draw</button>
    <button class="btn-custom" onclick="exportWinnersPDF()">Download PDF</button>
    <button class="btn-custom" onclick="resetWinners()">Reset Winners</button>
    <button class="btn-custom" onclick="exportWinnersExcel()">Export to Excel</button>
    <button class="btn-custom" onclick="deleteAllParticipants()">Delete All Participants</button>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden">
        <h2>Manage Participants</h2>
        <input type="text" id="participantName" placeholder="Enter Name" class="form-control mb-2">
        <input type="text" id="traderAddress" placeholder="Enter Trader Address" class="form-control mb-2">
        <button class="btn-custom" onclick="addParticipant()">Add/Update</button>

        <hr>
        <h3>Upload Excel File</h3>
        <input type="file" id="excelFile" accept=".xlsx, .xls" class="form-control mb-2">
        <button class="btn-custom" onclick="uploadExcel()">Upload Participants</button>
        <a href="#" onclick="downloadTemplate()" class="btn-custom">Download Template</a>

        <table id="participantTable" class="table table-bordered mt-3">
            <thead>
                <tr><th>S. No</th><th>Name</th><th>Trader Address</th><th>Actions</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Winners Section -->
    <div id="winnerList" class="hidden">
        <h2>Winners</h2>
        <table id="winnersTable" class="table table-bordered">
            <thead>
                <tr><th>S. No</th><th>Name</th><th>Trader Address</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        let participants = JSON.parse(localStorage.getItem('participants')) || [];
        let winners = JSON.parse(localStorage.getItem('winners')) || [];
        let editIndex = -1;

        function toggleAdminPanel() {
            document.getElementById('adminPanel').classList.toggle('hidden');
            renderTable();
        }

        function addParticipant() {
            const name = document.getElementById('participantName').value.trim();
            const traderAddress = document.getElementById('traderAddress').value.trim();

            if (!name || !traderAddress) return alert("Please enter both Name and Trader Address.");

            if (editIndex === -1) {
                participants.push({ name, traderAddress });
            } else {
                participants[editIndex] = { name, traderAddress };
                editIndex = -1;
            }

            localStorage.setItem('participants', JSON.stringify(participants));
            renderTable();
        }

        function renderTable() {
            const tbody = document.querySelector('#participantTable tbody');
            tbody.innerHTML = '';
            participants.forEach((p, i) => {
                tbody.innerHTML += `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${p.name}</td>
                        <td>${p.traderAddress}</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editParticipant(${i})">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteParticipant(${i})">Delete</button>
                        </td>
                    </tr>`;
            });
        }

        function uploadExcel() {
            const fileInput = document.getElementById('excelFile');
            if (!fileInput.files.length) return alert("Please select an Excel file.");

            const reader = new FileReader();
            reader.onload = function (e) {
                const workbook = XLSX.read(e.target.result, { type: 'binary' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const data = XLSX.utils.sheet_to_json(sheet);

                data.forEach(row => {
                    if (row.Name && row['Trader Address']) {
                        participants.push({ name: row.Name, traderAddress: row['Trader Address'] });
                    }
                });

                localStorage.setItem('participants', JSON.stringify(participants));
                alert("Participants uploaded successfully!");
                renderTable();
            };
            reader.readAsBinaryString(fileInput.files[0]);
        }

        function startDraw() {
            if (participants.length === 0) return alert("No participants available for the draw.");
            const winnerIndex = Math.floor(Math.random() * participants.length);
            const winner = participants[winnerIndex];
            winners.push(winner);
            localStorage.setItem('winners', JSON.stringify(winners));
            alert(`Winner: ${winner.name}`);
            renderWinners();
        }

        function renderWinners() {
            const winnerList = document.getElementById('winnerList');
            winnerList.classList.remove('hidden');
            const tbody = document.querySelector('#winnersTable tbody');
            tbody.innerHTML = '';
            winners.forEach((w, i) => {
                tbody.innerHTML += `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${w.name}</td>
                        <td>${w.traderAddress}</td>
                    </tr>`;
            });
        }

        function deleteAllParticipants() {
            if (confirm("Are you sure you want to delete all participants?")) {
                participants = [];
                localStorage.setItem('participants', JSON.stringify(participants));
                renderTable();
            }
        }

        renderTable();
        renderWinners();
    </script>
</body>
</html>
